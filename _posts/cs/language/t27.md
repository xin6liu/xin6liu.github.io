# CPU 的工作原理

控制单元，计算单元，存储单元

## 控制器

控制器组成：
程序计数器 (存储下一条指令的地址)
时序发生器
指令译码器 （翻译指令(操作码+地址码)）
各种寄存器Register (指令,地址,数据,通用)
总线

控制单元：IR, ID, OC
指令寄存器IR（Instruction Register）
指令译码器ID（Instruction Decoder）
操作控制器OC（Operation Controller）

它根据用户预先编好的程序，依次从存储器中(内存或cache)取出各条指令，放在指令寄存器IR中，通过指令译码（分析）确定应该进行什么操作，然后通过操作控制器OC，按确定的时序，向相应的部件发出微操作控制信号。

存储单元：cache 和 各种寄存器

原来是程序计数器先拿到下一条指令的名称（？），然后再根据这个名称在高速缓存里的指令寄存器里拿到该指令的地址码和操作码放到指令寄存器中。
由此产生另一个问题，在最开始的时候，程序计数器是怎么拿到下一条指令的名称（？）的呢？



## 工作原理

总的来说，CPU 从内存中一条一条地取出指令和相应的数据，按指令操作码的规定，对数据进行运算处理，直到程序执行完毕为止。具体过程可分为以下四步：

【1】取指令
CPU 控制器从内存读取一条指令并放入指令寄存器。指令的格式：操作码+操作数地址
操作码：就是汇编语言里的 mov，add，jmp 等符号码；
操作数地址：说明该指令需要的操作数所在的地方，是在内存里还是在CPU的内部寄存器里。

【2】指令译码
指令寄存器中的指令经过译码，决定该指令应进行何种操作（就是指令里的操作码）、操作数在哪里（操作数的地址） 。

【3】 执行指令
执行指令分为两个阶段： 取操作数 和 进行运算 。
取操作数：CPU 通过寻址操作，从内存（数据段）中读取操作数到通用寄存器中，暂存起来。
进行运算：运算单元通过指令中的操作码，对寄存器中的操作数进行 mov，add，jmp 操作。

【4】 指令计数
修改指令计数器，决定下一条指令的地址 。CPU 重复上述三步操作，处于内存代码段的指令被逐个的执行，直到程序执行完毕为止。