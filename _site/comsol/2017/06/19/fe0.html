<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
  <meta charset="utf-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Docker + FEniCS &middot; LiuXin
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/simple/poole.css">
  <link rel="stylesheet" href="/assets/css/simple/lanyon.css">
</head>



  <body>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">LiuXin</a>
            <small>COMSOL专题</small>
          </h3>
        </div>
      </div>
      <div class="container content">


<!-- 正文 -->
<div class="post">
  <h1 class="post-title">Docker + FEniCS</h1>
  <span class="post-date">19 Jun 2017 </span>
  <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath:[['$','$']]}});</script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <ol>
  <li>安装Docker</li>
  <li>安装Docker Quickstart Terminal</li>
  <li>在docker is running 的情况下，启动Docker QuickStart Terminal</li>
  <li>在docker quick start terminal 里输入 <code class="highlighter-rouge">docker-machine rm default</code> （以后我用前面加$表示在terminal里输入的命令）</li>
  <li><code class="highlighter-rouge">$ docker run hello-world</code> （测试docker是否可以运行）</li>
  <li><code class="highlighter-rouge">$ docker pull quay.io/fenicsproject/stable:latest</code> (下载fenics)</li>
  <li><code class="highlighter-rouge">$ docker run -ti quay.io/fenicsproject/stable:latest</code>(启动fenics)</li>
  <li>步骤7的局限就是只能运行container里面的demo文件，所以可以跳过步骤7，运行：<code class="highlighter-rouge">$ docker run -ti -v $(pwd):/home/fenics/shared quay.io/fenicsproject/stable</code> （如果已经运行步骤7，可以关掉terminal，直接运行8，因为之前都是下载的步骤）可以看出8比7多了的命令为<code class="highlighter-rouge">-v $(pwd):/home/fenics/shared</code> 其中<code class="highlighter-rouge">$(pwd)</code>是Pathname of the current Working Directory, 如果退出docker环境，在terminal输入<code class="highlighter-rouge">$ pwd</code>，下面就会出现$(pwd)所代表的路径，我的是/Users/liuxin，其中liuxin是我的用户名，也就是用户根目录。所以进行8之前可以先在根目录建立一个文件夹叫fenics, 然后输入<code class="highlighter-rouge">$ cd fenics</code>，进入那个文件后再运行8的命令，此时的$(pwd)就代表/Users/liuxin/fenics。然后在fenics里面放入你的python文件就可以访问了。</li>
  <li>将你写的一个python文件，例如test.py放入刚才的fenics文件夹里，再在terminal里输入：<code class="highlighter-rouge">$ cd $HOME/shared</code>和<code class="highlighter-rouge">$ python test.py</code></li>
</ol>

<p><img src="http://wx3.sinaimg.cn/mw690/8db2c8cbgy1fhaqlhm8jpj20lf0jmjv1.jpg" alt="" />
(步骤8-9：打开fenics，运行test.py）</p>

<p>我运行test.py其实是官网给出的possion方程的例子，可以看出得出了结果：error_L2 和 error_。至于图像，terminal里是打不开pad的，所以test.py里有一句：
	# Save solution to file in VTK format
	vtkfile = File(‘poisson/solution.pvd’)
我们打开fenics文件夹就会发现passion的图像文件被输出到那里了：
<img src="http://wx1.sinaimg.cn/mw690/8db2c8cbgy1fhaqlk9tfpj207502baa6.jpg" alt="" /></p>

<h3 id="给你的container命名">给你的container命名：￼</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -ti -v $(pwd):/home/fenics/shared --name fenics-container quay.io/fenicsproject/stable 
</code></pre></div></div>

<p>相较于步骤8，这里多了：<code class="highlighter-rouge">--name fenics-container</code> ，也就是把你的container命名为fenics-container了。</p>

<p>输入<code class="highlighter-rouge">$ exit</code>退出这个container</p>

<p>输入<code class="highlighter-rouge">docker ps -a</code>查看container列表：
<img src="http://wx2.sinaimg.cn/mw690/8db2c8cbgy1fhaqllmbr9j20xq04rabp.jpg" alt="" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run --name notebook -w /home/fenics -v $(pwd):/home/fenics/shared -d -p $(docker-machine ip $(docker-machine active)):8888:8888 quay.io/fenicsproject/stable 'jupyter-notebook --ip=0.0.0.0'
</code></pre></div></div>

<p>然后在terminal上查看你的ip:
<code class="highlighter-rouge">$ docker-machine ip $(docker-machine active)</code>。
例如我的是：192.168.99.100</p>

<p>之后在浏览器中打开：http://此处填你的ip:8888，例如我的是：http://192.168.99.100:8888</p>

<p>讲道理这里就可以打开jupyter notebook了，可是有可能会出现一个要密码的页面，这就很蛋疼了。</p>

<p>我解决的方法如下：</p>

<p>先把刚才的container删掉：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker stop notebook
$ docker rm notebook
</code></pre></div></div>

<p>创建一个密码：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jupyter notebook --generate-config
$ jupyter notebook password
</code></pre></div></div>

<p>这时会出现<code class="highlighter-rouge">Enter password: </code>，输入你想设置的密码如123，但这里屏幕是不显示你在打字的，不要管他，输完点回车即可。</p>

<p>这时查看你的juster文件夹，会多出一个<code class="highlighter-rouge">jupyter\_notebook\_config.json</code>文件，用文字编辑器打开它，我的里面写的是：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "NotebookApp": {
    "password": "sha1:da81c88402f0:55a9107941d889a2f8b29d1297c04351920475d6"
  }
}
</code></pre></div></div>

<p>复制的你密码，这里也就是sha1:da81c88402f0:55a9107941d889a2f8b29d1297c04351920475d6</p>

<p>运行</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run --name notebook -w /home/fenics -v $(pwd):/home/fenics/shared -d -p $(docker-machine ip $(docker-machine active)):8888:8888 quay.io/fenicsproject/stable 'jupyter-notebook --ip=0.0.0.0 --NotebookApp.password='sha1:da81c88402f0:55a9107941d889a2f8b29d1297c04351920475d6''
</code></pre></div></div>

<p>和上面那个步骤很相似，只不过尾部多了<code class="highlighter-rouge">--NotebookApp.password='sha1:da81c88402f0:55a9107941d889a2f8b29d1297c04351920475d6'</code>这个命令，这里的密码填你生成的密码。</p>

<p>再在浏览器输入http://此处填你的ip:8888，在要求输密码的地方输入刚才的123.</p>


</div>

<!-- 相关 -->
<div class="related">
  <h1>CATEGORY</h1>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/ai/2018/03/18/ai.html">
            机器学习
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/01/06/mns.html">
            纳米材料与技术 Materials and Nanoscience
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/01/05/comsol.html">
            物理场耦合仿真 COMSOL Multiphysics
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/01/04/cs.html">
            计算机科学 Computer Science
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/01/03/course.html">
            课程 Course
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/01/02/categories.html">
            总目录 Categories
          </a>
        </h3>
      </li>
    
  </ul>
</div>


</div>
    </div>

  </body>
</html>
